{% extends 'base.html' %}
{% load crispy_forms_field %}
{% load crispy_forms_filters %}

{% block title %}
    Games
{% endblock %}

{% block content %}
    <div class="col-lg-6 mt-5">
    <p class="text-center fs-2">Not Calculated Games</p>
        <hr>
        {% regroup games by competition as games_by_competition %}
        {% for competition, games in games_by_competition %}
            <p style="color:  #014a7f">{{ competition }}</p>
            <table class="table table-striped table-hover" style="font-size: 0.9rem; line-height: 1">
                <tbody>
                {% for game in games %}
                    <tr>
                        <td class="align-middle py-0 text-center">
                            {{ game.date | date:"d.m.Y" }}<br>
                            <sppan class="text-secondary">{{ game.date | date:"H:i" }}</sppan>
                        </td>
                        <td class="align-middle"><img class="border border-dark" src="{{ game.home_team.flag_url }}" style="width: 36px"> </td>
                        <td class="align-middle text-center">
                            {{ game.home_team.country_code }}<br>
                            {% if game.home_points_change > 0 %}
                                <span class="text-success" style="font-size: 0.8rem">+{{ game.home_points_change | floatformat:2 }}</span>
                            {% elif game.home_points_change < 0 %}
                                <span class="text-danger" style="font-size: 0.8rem">{{ game.home_points_change | floatformat:2 }}</span>
                            {% endif %}
                        </td>
                        <td class="align-middle text-center">
                            {{ game.home_goals }}
                            -
                            {{ game.away_goals }}
                        </td>
                        <td class="align-middle text-center">
                            {{ game.away_team.country_code }}<br>
                            {% if game.away_points_change > 0 %}
                                <span class="text-success" style="font-size: 0.8rem">+{{ game.away_points_change | floatformat:2 }}</span>
                            {% elif game.away_points_change < 0 %}
                                <span class="text-danger" style="font-size: 0.8rem">{{ game.away_points_change | floatformat:2 }}</span>
                            {% endif %}
                        </td>
                        <td class="align-middle"><img class="border border-dark" src="{{ game.away_team.flag_url }}" style="width: 36px"></td>
                    {% if request.user.is_staff %}
                        <td class="align-middle">
                        <a class="text-decoration-none text-success" href="{% url 'calculate_games' game.id %}">Calculate</a> /
                        <a class="text-decoration-none text-danger" href="{% url 'delete_game' game.id %}">Delete</a>
                    </td>
                    {% endif %}
                    </tr>
                {% endfor %}

                </tbody>
            </table>
        {% endfor %}
        {% if not games %}
            <p class="text-center mb-0">No games</p>
        {% endif %}
    </div>
{% endblock %}